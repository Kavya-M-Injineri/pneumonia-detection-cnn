{% extends "base.html" %}

{% block content %}
<nav class="navbar">
    <div class="nav-brand">
        <i class="fa-solid fa-heart-pulse"></i>
        <span>MedAI Classifier</span>
    </div>
    <div class="nav-user">
        <a href="/reports" class="nav-link"><i class="fa-solid fa-list-check"></i> View Reports</a>
        <span class="user-role">{{ user.name }} ({{ user.role | title }})</span>
        <button class="btn-logout" onclick="window.location.href='/logout'">
            <i class="fa-solid fa-right-from-bracket"></i>
        </button>
    </div>
</nav>

<main class="dashboard-container">
    <div class="dashboard-header">
        <h2>Chest X-Ray Analysis</h2>
        <p>Upload a PA view chest X-ray for instant Pneumonia screening.</p>
    </div>

    <div class="analysis-grid">
        <!-- Upload Section -->
        <div class="card upload-card">
            <h3>Date Input</h3>
            <div class="drop-zone" id="dropZone">
                <input type="file" id="fileInput" accept="image/png, image/jpeg" hidden>
                <div class="upload-content">
                    <i class="fa-solid fa-cloud-arrow-up upload-icon"></i>
                    <p class="primary-text">Drag & Drop X-ray Image</p>
                    <p class="secondary-text">or <span class="browse-link">browse files</span></p>
                    <p class="file-info">Supports JPG, PNG (Max 16MB)</p>
                </div>
                <div class="preview-container" id="previewContainer" style="display: none;">
                    <img id="imagePreview" src="" alt="X-ray Preview">
                    <button class="btn-remove" id="removeBtn"><i class="fa-solid fa-xmark"></i></button>
                </div>
            </div>
            <button id="analyzeBtn" class="btn-primary btn-block" disabled>
                <i class="fa-solid fa-microscope"></i> Analyze Image
            </button>
        </div>

        <!-- Result Section -->
        <div class="card result-card" id="resultCard" style="display: none;"> <!-- Initially hidden or dim -->
            <h3>Analysis Report</h3>

            <div id="loading" class="loading-state" style="display: none;">
                <div class="spinner"></div>
                <p>Analyzing Scan Patterns...</p>
            </div>

            <div id="resultContent" class="result-content" style="display: none;">
                <div class="status-badge" id="statusBadge">
                    <!-- Injected by JS: Normal or Pneumonia -->
                </div>

                <div class="confidence-meter">
                    <svg viewBox="0 0 36 36" class="circular-chart">
                        <path class="circle-bg"
                            d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <path class="circle" id="confidenceStroke" stroke-dasharray="0, 100"
                            d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <text x="18" y="20.35" class="percentage" id="confidenceText">0%</text>
                    </svg>
                    <p class="label">AI Confidence</p>
                </div>

                <div class="medical-details">
                    <div class="detail-item">
                        <h4><i class="fa-solid fa-file-medical"></i> Condition</h4>
                        <p id="conditionText" class="highlight-text">-</p>
                    </div>
                    <div class="detail-item">
                        <h4><i class="fa-solid fa-bacteria"></i> Pathogen Type</h4>
                        <p id="pathogenText" class="highlight-text">-</p>
                    </div>
                    <div class="detail-item">
                        <h4><i class="fa-solid fa-virus"></i> Potential Causes</h4>
                        <p id="causesText">-</p>
                    </div>

                    <div class="treatment-grid">
                        <div class="treatment-col">
                            <h4><i class="fa-solid fa-pills"></i> Suggested Antibiotics</h4>
                            <ul id="antibioticsList" class="treatment-list">
                                <!-- Populated by JS -->
                            </ul>
                        </div>
                        <div class="treatment-col">
                            <h4><i class="fa-solid fa-leaf"></i> Ayurvedic Remedies</h4>
                            <ul id="ayurvedicList" class="treatment-list">
                                <!-- Populated by JS -->
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- Disclaimer removed as requested -->
            </div>

            <div id="emptyState" class="empty-state">
                <i class="fa-solid fa-laptop-medical"></i>
                <p>Upload an image to see results</p>
            </div>
        </div>
    </div>
</main>
{% endblock %}